
var fs = require("fs");
var path = require("path");
var config = require("./utils/config");

//use the main js path as our cwd.

//process.argv[0] and process.argv[1] are all handle to the absolute path yet, just use.
var cwd = path.dirname(process.argv[1]);
process.chdir(cwd);


//must read config sync first
var conf;
try{
   conf = config.readsync("./config.ini");   
}catch(e){
   console.log("read config failed : " + e);
   process.exit(0);
}


//check we are in debug mode
var debug = 0;
if (process.argv[2] === "-t") {
   debug = 1;
}
else
{
   if( require("tty").isatty(1) )
   {
      console.log("server need run in daemon.");
      process.exit(0);
   }
}


//create server instance.
var server = require("./server");
global.server = module.exports = new server(debug, conf);

